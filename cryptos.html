<html>
   <head>
         <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
         
         <script src="https://code.highcharts.com/highcharts.js"></script>
   </head>
   <body>
   <table id="table"></table>
   <script>
      var apiUrl = 'https://min-api.cryptocompare.com/data/';

      function filterObject(obj, filter) {
         var ret = {};
         for(var p in obj) {
            if (obj.hasOwnProperty(p)) {
               if (filter(obj[p])) {
                  ret[p] = obj[p];
               }
            }
         }
         return ret;
      }
      function getData(key, callback) {
         $.ajax({
            type: "GET",
            url: apiUrl + 'histoday',
            data: {
               fsym: key,
               tsym: 'USD',
               limit: 60,
            },
            // dataType: 'jsonp',
            // headers: {  'Access-Control-Allow-Origin': 'htt://site allowed to access' },
            success: function( result ) {
               // console.log(result);
               var d = result.Data.map(function(r) {
                  return [r.time, r.open];
               });
               callback(d, key);
            },
            error: function(result) {
               console.log(result);
            }
         });
      }
      // var apiUrl = 'https://api.cryptonator.com/api/ticker/btc-usd';
      function getCoins() {
         $.ajax({
            type: "GET",
            url: apiUrl + 'all/coinlist',

            // dataType: 'jsonp',
            // headers: {  'Access-Control-Allow-Origin': 'htt://site allowed to access' },
            success: function( result ) {
               var data = result.Data;
               // console.log(result);
               var filtered = filterObject(data, function(a) { return a.SortOrder < 10; });
               // console.log(filtered);
               var html = '';
               var $table = $('#table');
               var i = 0;
               for(var f in filtered) {
                  // makeChart();
                  getData(f, function(data, key) {
                     var s = filtered[key];
                     // console.log(f);
                 
                     var $row = $('<tr>').appendTo($table);
                        var l = data.length;
                     var price = data[l - 1][1];
                     var yesterday = data[l - 2][1];
                     var lastWeek = data[l - 7][1];
                     console.log(key, price, yesterday, lastWeek);
                     // console.log(s.TotalCoinSupply, data.reverse()[0][1])
                     $row.html('<td>' + s.CoinName + '</td>' +
                     '<td>' + price + '</td>' + 
                     '<td>' + (((price / yesterday) - 1) * 100).toFixed(2) + '</td>' +
                     '<td>' + (((price / lastWeek) - 1) * 100).toFixed(2) + '</td>' + 
                     '<td><img src="https://www.cryptocompare.com' + s.ImageUrl + '"/></td>');
                     var $container = $('<div>', { id: f, class: 'chart' }); // .appendTo($row);
                     // console.log(data, $container);
                     $row.append( $('<td>').append($container ));
                     makeChart($container, data, i++, key);

                  });
               }

            },
            error: function(result) {
               console.log(result);
            }
         });

      }

      function makeChart($container, data, i, label) {
         console.log(data);
         // console.log(data);
         var myChart = new Highcharts.chart({
            chart: {
               renderTo: $container[0],
            },
            series: [{
               data: data,
               colorIndex: i,
               name: label,
            }]
         });
      }
   // self executing function here
   $(function() {
      Highcharts.setOptions({
         chart: {
            zoomType: 'x',
            type: 'spline',
         },
         credits: {
            enabled: false,
         },
         legend: {
            enabled: false,
         },
         title: {
            text: null,
         },
         xAxis: {
            type: 'datetime',
            visible: false
         },
         yAxis: {
            visible: false,
            
         },
         plotOptions: {
            series: {
               marker: {
                  enabled: false,
               },
            },
         },
      });
      getCoins();
   });
      // your page initialization code here
      // the DOM will be available here
     
   </script>
   <style>
      body {
         font-family: Arial, Helvetica, sans-serif;
      }
      img, .chart {
         height: 100px;
      }
   </style>
   </body>
   </html>